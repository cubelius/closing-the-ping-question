> Предупреждение! Гайд ещё пишется и обязательно будет дополняться. Следующие темы будут о проблемах Anti-DDoS, Bungeecord и небольшая информация для тех, у кого есть VDS

# Закрытие вопроса о высоком пинге
## Предыстория
Повторяясь неоднократное количество раз, пересмотрев сотни случаев с визгами и воплями с комментариями "помогите у меня большой пинг в табе!" и проведя огромное количество времени на то, чтобы это всё разъяснять под каждый отдельный случай, я написал этот репозиторий с целью познания и ввод в курс дела почему в Minecraft нет пинга и по каким причинам эта цифра в табе может подниматься до небес?

## 1. Измерение пинга
Можете забыть о цифрах в табе. В Minecraft показывается Latency. Latency - это сумма вашего пинга и, подчёркиваю, время обработки пакета вашим сервером. В виде формулы это выглядит вот так:

```
Latency = YourPing + Server
```

Для того, чтобы проверить пинг, воспользуйтесь программой [PingPlotter](https://www.pingplotter.com). Вбиваете айпи-адрес сервера и смотрите на потери. Если они есть и превышают норму (±10 PL) - проблема с вашим интернетом и её решайте как хотите. Ближе к Wi-Fi подходите, кабель проводите, провайдеру звоните, роутер проверяйте.

Если потери минимальны и пинг, допустим, 60, а в игре он больше этой цифры - проблема с вашим сервером. Тогда переходим к следующей теме.

## 2. Решение проблемы с сервером

Для начала нужно понять, какая идёт нагрузка и использование ресурсов процессора. Если хотя бы один из параметров забит более чем на 90%, не говоря уже о двух, то никакой речи не может идти о нормальной работе вашего сервера. Здесь просто необходимо улучшить ваш тариф.

Если первый пункт не помог, то проблема, вероятнее всего, в плагинах/модах или в том, что происходит в мире. Если у вас падает TPS, повышается MSPT, необходимо сделать анализ при помощи плагина Spark, введя команду ниже и подождав 15 минут:
```
spark profiler
```
После ожидания напишите следующее:
```
spark profiler --stop
```
## 2.1. Просмотр процессов
![](https://i.imgur.com/5mJsvZ0.png)

Переходите по ссылке и смотрите, какие процессы влияют на производительность. К примеру, на этом скриншоте энтити в `net.minecraft.server.level.WorldServer.tick()` заняли 34.52% от общих тиков. Они смотрятся при помощи команды `/mspt`. В таком состоянии mspt сервера равно 6,6мс в среднем. 35% - уже не очень хорошо, если у вас оно больше 50% - вам нужно оптимизировать сервер. Могу порекомендовать [этот гайд](https://github.com/YouHaveTrouble/minecraft-optimization).

## 2.2. Просмотр плагинов
![](https://i.imgur.com/D4kp6sK.png)

Если ничего не поняли - нажмите на вкладку plugins, поставьте Label: Time per tick и смотрите на числа. Если какой-то плагин занимает больше 5мс - временно удалите его. Не дай Боже, чтобы у вас это число было в два раза больше или таких плагинов было несколько штук. Удивительно, как ваш сервер вообще работает с подобным дерьмом.

Всё в порядке? Значит проблема из-за огромного количества энтити или каких-то других проблем с сервером. Опять же, переходите по [этому гайду](https://github.com/YouHaveTrouble/minecraft-optimization).

## 3. Случаи-исключения
Проблемы на стороне хостинга. Они бывают крайне редко и если они появились, поддержка или администрация обязательно уведомят об этом.
